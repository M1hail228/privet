const rows = 3; const cols = 3; const puzzle = document.getElementById("puzzle"); const winScreen = document.getElementById("winScreen"); const buttons = document.querySelectorAll("[data-dir]"); let tiles = []; // –º–∞—Å—Å–∏–≤ DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ let emptyTile; // —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É let selectedTile = null; /* ===================== –°–û–ó–î–ê–ù–ò–ï ===================== */ function createPuzzle() { const total = rows * cols; for (let i = 0; i < total - 1; i++) { const tile = document.createElement("div"); tile.className = "tile"; const x = i % cols; const y = Math.floor(i / cols); tile.style.backgroundImage = "url('image.jpg')"; tile.style.backgroundSize = "300% 300%"; tile.style.backgroundPosition = ${(x/(cols-1))*100}% ${(y/(rows-1))*100}%; tile.dataset.correct = i; // –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è tile.onclick = () => select(tile); tiles.push(tile); } emptyTile = document.createElement("div"); emptyTile.className = "tile empty"; tiles.push(emptyTile); smartShuffle(); render(); } /* ===================== –í–´–ë–û–† ===================== */ function select(tile) { if (tile === emptyTile) return; selectedTile = tile; render(); } /* ===================== –î–í–ò–ñ–ï–ù–ò–ï ===================== */ buttons.forEach(btn => btn.onclick = () => { if (!selectedTile) return; move(btn.dataset.dir); } ); function move(dir) { const i = tiles.indexOf(selectedTile); const empty = tiles.indexOf(emptyTile); const row = Math.floor(i / cols); const col = i % cols; let target = null; if (dir === "up") target = i - cols; if (dir === "down") target = i + cols; if (dir === "left") target = i - 1; if (dir === "right") target = i + 1; // –º–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–ª—å = –ø—É—Å—Ç–∞—è if (target === empty) { [tiles[i], tiles[empty]] = [tiles[empty], tiles[i]]; render(); checkWin(); } } /* ===================== –†–ï–ù–î–ï–† ===================== */ function render() { puzzle.innerHTML = ""; tiles.forEach(t => { t.classList.toggle("active", t === selectedTile); puzzle.appendChild(t); }); } /* ===================== –ü–ï–†–ï–ú–ï–®–ò–í–ê–ù–ò–ï ===================== */ function smartShuffle() { for (let k = 0; k < 40; k++) { const empty = tiles.indexOf(emptyTile); const neighbors = getNeighbors(empty); const rand = neighbors[Math.floor(Math.random()*neighbors.length)]; [tiles[empty], tiles[rand]] = [tiles[rand], tiles[empty]]; } } function getNeighbors(i) { const n = []; const row = Math.floor(i / cols); const col = i % cols; if (row > 0) n.push(i - cols); if (row < rows-1) n.push(i + cols); if (col > 0) n.push(i - 1); if (col < cols-1) n.push(i + 1); return n; } /* ===================== –ü–û–ë–ï–î–ê ===================== */ function checkWin() { for (let i = 0; i < tiles.length - 1; i++) { if (+tiles[i].dataset.correct !== i) return; } winScreen.classList.remove("hidden"); } /* ===================== –°–¢–ê–†–¢ ===================== */ createPuzzle(); /* ===================== –ú–£–ó–´–ö–ê ===================== */ const bgMusic = document.getElementById("bgMusic"); const music2 = document.getElementById("music2"); const music3 = document.getElementById("music3"); document.body.addEventListener("click", () => { bgMusic.play().catch(()=>{}); }, { once: true }); /* ===================== STAGE 2 ===================== */ const stage2 = document.getElementById("stage2"); const finalStage = document.getElementById("finalStage"); const bigPhoto = document.getElementById("bigPhoto"); const crack = document.getElementById("crack"); let hits = 0; /* üî• –ú–û–î–ò–§–ò–¶–ò–†–£–ï–ú checkWin */ const oldCheckWin = checkWin; checkWin = function() { oldCheckWin(); if (!win.classList.contains("hidden")) { startStage2(); } }; function startStage2() { bgMusic.pause(); music2.play(); stage2.classList.remove("hidden"); } bigPhoto.onclick = () => { hits++; crack.classList.remove("hidden"); crack.style.opacity = 0.3 + hits * 0.07; if (hits >= 10) { stage2.classList.add("hidden"); music2.pause(); music3.play(); finalStage.classList.remove("hidden"); } };